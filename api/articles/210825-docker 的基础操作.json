{"title":"docker 的基础操作","slug":"210825-docker 的基础操作","date":"2021-08-25T04:00:00.000Z","updated":"2023-12-22T08:04:15.777Z","comments":true,"path":"api/articles/210825-docker 的基础操作.json","realPath":null,"excerpt":"docker 是一个开源的应用容器引擎，轻量化、可移植、一键打包、快速测试等特点不容错过","covers":["data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="],"cover":"https://pic.wuzhiping.top/blog/202306041724325.jpg","content":"<p>docker 是一个开源的应用容器引擎，它使用 Go 编程语言编写，提供一种名为”容器”的隔离工作空间技术，使得用户可以快速使用、跨平台移植，就如海上的集装箱，docker 把打包好的应用通过守护进程发布到任何流行的Linux 或 Windows 机器上。</p>\n<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/frankwuzp/pic/blog/202108251529323.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">docker 工作原理图示，来自：官方文档</span></p>\n<p>以下内容是基于使用 docker 过程的记录和心得体会，将实时更新。</p>\n<h2 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h2><ul>\n<li>Windows 10 电脑</li>\n<li>树莓派4B(系统版本如下)<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">$ <span class=\"hljs-built_in\">uname</span> -a<br>Linux raspberrypi 5.10.52-v7l+ <span class=\"hljs-comment\">#1441 SMP Tue Aug 3 18:11:56 BST 2021 armv7l GNU/Linux</span><br>$ lsb_release -cs<br>buster<br></code></pre></td></tr></table></figure></li>\n<li>联网环境</li>\n</ul>\n<h2 id=\"安装docker-ce\"><a href=\"#安装docker-ce\" class=\"headerlink\" title=\"安装docker-ce\"></a>安装docker-ce</h2><p>目前公共的版本是 docker-ce ，即社区版</p>\n<p>以树莓派为例（Debian 发行版）为例，安装前先配置环境</p>\n<ol>\n<li>确保安装依赖</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>信任 Docker 的 GPG 公钥</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -<br>ok<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>添加软件仓库</li>\n</ol>\n<ul>\n<li><p>树莓派等ARM架构计算机</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \\</span><br><span class=\"hljs-string\">     <span class=\"hljs-subst\">$(lsb_release -cs)</span> stable&quot;</span> | \\<br>    sudo <span class=\"hljs-built_in\">tee</span> /etc/apt/sources.list.d/docker.list<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>amd64 架构的计算机</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo add-apt-repository \\<br>   <span class=\"hljs-string\">&quot;deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \\</span><br><span class=\"hljs-string\">   <span class=\"hljs-subst\">$(lsb_release -cs)</span> \\</span><br><span class=\"hljs-string\">   stable&quot;</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n<ol start=\"4\">\n<li>最后一步，使用命令行安装 docker-ce</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo apt update<br>sudo apt install docker-ce<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"换源加速-docker-pull-的速度\"><a href=\"#换源加速-docker-pull-的速度\" class=\"headerlink\" title=\"换源加速 docker pull 的速度\"></a>换源加速 <code>docker pull</code> 的速度</h2><p>详见另一篇博文 <a href=\"https://m.wuzhiping.top/p/247374a.html#docker-%E6%8D%A2%E6%BA%90\">国内开源镜像站点及替换方式</a>，<br>思路是修改 <code>/etc/docker/daemon.json</code> 的文件内容，最后重载配置、重启 docker即可</p>\n<h2 id=\"docker-去除-sudo-启动\"><a href=\"#docker-去除-sudo-启动\" class=\"headerlink\" title=\"docker 去除 sudo 启动\"></a>docker 去除 <code>sudo</code> 启动</h2><p><font color=red>不加 <code>sudo</code> 时启动 docker 会报错：</font></p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs txt\">Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.38/images/json: dial unix /var/run/docker.sock: connect: permission denied<br></code></pre></td></tr></table></figure>\n\n<p>解决办法如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 新建一个 docker 组</span><br>sudo groupadd docker<br><span class=\"hljs-comment\"># 将docker账户给与权限</span><br>sudo gpasswd -a &lt;username&gt; docker<br><span class=\"hljs-comment\"># 重启 docker</span><br>sudo service docker restart<br></code></pre></td></tr></table></figure>\n<p>退出 shell ，重进即可不带 <code>sudo</code> 使用 docker</p>\n<p>或者使用如下命令: </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">systemctl unmask docker.service<br>systemctl unmask docker.socket<br>systemctl start docker.service<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"docker-的查询命令\"><a href=\"#docker-的查询命令\" class=\"headerlink\" title=\"docker 的查询命令\"></a>docker 的查询命令</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 列出所有在运行的容器信息：</span><br>docker ps<br><span class=\"hljs-comment\"># 查询所有已安装的 docker 镜像文件：</span><br>docker images<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><ul>\n<li><a target=\"_blank\" rel=\"noopener\" href=\"https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/\">docker-ce | 镜像站使用帮助</a></li>\n<li><a target=\"_blank\" rel=\"noopener\" href=\"https://shumeipai.nxez.com/2019/05/20/how-to-install-docker-on-your-raspberry-pi.html\">树莓派实验室</a></li>\n<li><a target=\"_blank\" rel=\"noopener\" href=\"https://docs.docker.com/get-started/overview/\">Docker 官方文档（英文版）</a></li>\n<li><a target=\"_blank\" rel=\"noopener\" href=\"https://stackoverflow.com/questions/44678725/cannot-connect-to-the-docker-daemon-at-unix-var-run-docker-sock-is-the-docker\">Stack Overflow</a></li>\n</ul>\n<h2 id=\"Changlog\"><a href=\"#Changlog\" class=\"headerlink\" title=\"Changlog\"></a>Changlog</h2><ul>\n<li>2023&#x2F;06&#x2F;04 修改细节，更新补充内容</li>\n<li>2021&#x2F;08&#x2F;25 init</li>\n</ul>\n","more":"<p>docker 是一个开源的应用容器引擎，它使用 Go 编程语言编写，提供一种名为”容器”的隔离工作空间技术，使得用户可以快速使用、跨平台移植，就如海上的集装箱，docker 把打包好的应用通过守护进程发布到任何流行的Linux 或 Windows 机器上。</p>\n<p><img  src=\"https://cdn.jsdelivr.net/gh/frankwuzp/pic/blog/202108251529323.png\"  ><span class=\"image-caption\">docker 工作原理图示，来自：官方文档</span></p>\n<p>以下内容是基于使用 docker 过程的记录和心得体会，将实时更新。</p>\n<h2 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h2><ul>\n<li>Windows 10 电脑</li>\n<li>树莓派4B(系统版本如下)<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">$ <span class=\"hljs-built_in\">uname</span> -a<br>Linux raspberrypi 5.10.52-v7l+ <span class=\"hljs-comment\">#1441 SMP Tue Aug 3 18:11:56 BST 2021 armv7l GNU/Linux</span><br>$ lsb_release -cs<br>buster<br></code></pre></td></tr></table></figure></li>\n<li>联网环境</li>\n</ul>\n<h2 id=\"安装docker-ce\"><a href=\"#安装docker-ce\" class=\"headerlink\" title=\"安装docker-ce\"></a>安装docker-ce</h2><p>目前公共的版本是 docker-ce ，即社区版</p>\n<p>以树莓派为例（Debian 发行版）为例，安装前先配置环境</p>\n<ol>\n<li>确保安装依赖</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>信任 Docker 的 GPG 公钥</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -<br>ok<br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>添加软件仓库</li>\n</ol>\n<ul>\n<li><p>树莓派等ARM架构计算机</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \\</span><br><span class=\"hljs-string\">     <span class=\"hljs-subst\">$(lsb_release -cs)</span> stable&quot;</span> | \\<br>    sudo <span class=\"hljs-built_in\">tee</span> /etc/apt/sources.list.d/docker.list<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>amd64 架构的计算机</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo add-apt-repository \\<br>   <span class=\"hljs-string\">&quot;deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \\</span><br><span class=\"hljs-string\">   <span class=\"hljs-subst\">$(lsb_release -cs)</span> \\</span><br><span class=\"hljs-string\">   stable&quot;</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n<ol start=\"4\">\n<li>最后一步，使用命令行安装 docker-ce</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo apt update<br>sudo apt install docker-ce<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"换源加速-docker-pull-的速度\"><a href=\"#换源加速-docker-pull-的速度\" class=\"headerlink\" title=\"换源加速 docker pull 的速度\"></a>换源加速 <code>docker pull</code> 的速度</h2><p>详见另一篇博文 <a href=\"https://m.wuzhiping.top/p/247374a.html#docker-%E6%8D%A2%E6%BA%90\">国内开源镜像站点及替换方式</a>，<br>思路是修改 <code>/etc/docker/daemon.json</code> 的文件内容，最后重载配置、重启 docker即可</p>\n<h2 id=\"docker-去除-sudo-启动\"><a href=\"#docker-去除-sudo-启动\" class=\"headerlink\" title=\"docker 去除 sudo 启动\"></a>docker 去除 <code>sudo</code> 启动</h2><p><font color=red>不加 <code>sudo</code> 时启动 docker 会报错：</font></p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs txt\">Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.38/images/json: dial unix /var/run/docker.sock: connect: permission denied<br></code></pre></td></tr></table></figure>\n\n<p>解决办法如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 新建一个 docker 组</span><br>sudo groupadd docker<br><span class=\"hljs-comment\"># 将docker账户给与权限</span><br>sudo gpasswd -a &lt;username&gt; docker<br><span class=\"hljs-comment\"># 重启 docker</span><br>sudo service docker restart<br></code></pre></td></tr></table></figure>\n<p>退出 shell ，重进即可不带 <code>sudo</code> 使用 docker</p>\n<p>或者使用如下命令: </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">systemctl unmask docker.service<br>systemctl unmask docker.socket<br>systemctl start docker.service<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"docker-的查询命令\"><a href=\"#docker-的查询命令\" class=\"headerlink\" title=\"docker 的查询命令\"></a>docker 的查询命令</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 列出所有在运行的容器信息：</span><br>docker ps<br><span class=\"hljs-comment\"># 查询所有已安装的 docker 镜像文件：</span><br>docker images<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"Ref\"><a href=\"#Ref\" class=\"headerlink\" title=\"Ref\"></a>Ref</h2><ul>\n<li><a target=\"_blank\" rel=\"noopener\" href=\"https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/\">docker-ce | 镜像站使用帮助</a></li>\n<li><a target=\"_blank\" rel=\"noopener\" href=\"https://shumeipai.nxez.com/2019/05/20/how-to-install-docker-on-your-raspberry-pi.html\">树莓派实验室</a></li>\n<li><a target=\"_blank\" rel=\"noopener\" href=\"https://docs.docker.com/get-started/overview/\">Docker 官方文档（英文版）</a></li>\n<li><a target=\"_blank\" rel=\"noopener\" href=\"https://stackoverflow.com/questions/44678725/cannot-connect-to-the-docker-daemon-at-unix-var-run-docker-sock-is-the-docker\">Stack Overflow</a></li>\n</ul>\n<h2 id=\"Changlog\"><a href=\"#Changlog\" class=\"headerlink\" title=\"Changlog\"></a>Changlog</h2><ul>\n<li>2023&#x2F;06&#x2F;04 修改细节，更新补充内容</li>\n<li>2021&#x2F;08&#x2F;25 init</li>\n</ul>\n","categories":[{"name":"技术向","path":"api/categories/技术向.json"},{"name":"树莓派","path":"api/categories/树莓派.json"},{"name":"Linux","path":"api/categories/Linux.json"},{"name":"docker","path":"api/categories/docker.json"}],"tags":[{"name":"技术","path":"api/tags/技术.json"},{"name":"docker","path":"api/tags/docker.json"},{"name":"Linux","path":"api/tags/Linux.json"},{"name":"远程访问","path":"api/tags/远程访问.json"},{"name":"教程","path":"api/tags/教程.json"}]}